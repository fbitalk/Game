# äººç”Ÿæ¨¡æ‹Ÿå™¨äº‹ä»¶ç³»ç»Ÿå®Œæ•´æŒ‡å—

## ä¸€ã€äº‹ä»¶ç³»ç»Ÿæ¦‚è¿°

æ¸¸æˆä¸­çš„äº‹ä»¶ç³»ç»ŸåŒ…å«ä»¥ä¸‹å‡ ç§ç±»å‹ï¼š

1. **å¼€å±€äº‹ä»¶** (`STARTING_EVENTS`) - 0å²æ—¶çš„å‡ºç”Ÿäº‹ä»¶
2. **å¼€å±€æ ‡ç­¾äº‹ä»¶** (`STARTING_TAG_EVENTS`) - ç‰¹æ®Šå¼€å±€çš„åç»­è¿ç»­äº‹ä»¶
3. **æ ‡ç­¾äº‹ä»¶** (`TAG_EVENTS`) - æ‹¥æœ‰ç‰¹å®šæ ‡ç­¾æ—¶å¯è§¦å‘çš„äº‹ä»¶
4. **å¹´é¾„æ®µäº‹ä»¶** (`ageEvents`) - ç‰¹å®šå¹´é¾„æ®µçš„æ™®é€šäº‹ä»¶

## äºŒã€æ ‡ç­¾ç³»ç»Ÿè¯´æ˜

### 2.1 æ ‡ç­¾å®šä¹‰ç»“æ„

```javascript
TAG_DEFINITIONS: new Map([
    ["æ ‡ç­¾å", {
        description: "æ ‡ç­¾æè¿°",
        exclusive_events: [],  // ç‹¬å äº‹ä»¶IDæ•°ç»„ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
        priority_events: [],   // ä¼˜å…ˆäº‹ä»¶IDæ•°ç»„ï¼ˆè¾ƒé«˜ä¼˜å…ˆçº§ï¼‰
        is_red: false,        // æ˜¯å¦ä¸ºçº¢è‰²æ ‡ç­¾ï¼ˆç‰¹æ®Šè´Ÿé¢çŠ¶æ€ï¼‰
        is_dynamic: false,    // æ˜¯å¦ä¸ºåŠ¨æ€æ ‡ç­¾
        prefix: "æ ‡ç­¾å‰ç¼€:"   // åŠ¨æ€æ ‡ç­¾çš„å‰ç¼€
    }]
])
```

### 2.2 çº¢è‰²æ ‡ç­¾æœºåˆ¶

çº¢è‰²æ ‡ç­¾æ˜¯ç‰¹æ®Šçš„è´Ÿé¢çŠ¶æ€æ ‡ç­¾ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š
- åœ¨UIä¸­æ˜¾ç¤ºä¸ºçº¢è‰²
- æ‹¥æœ‰çº¢è‰²æ ‡ç­¾æ—¶ï¼Œåªèƒ½è§¦å‘è¯¥æ ‡ç­¾çš„ç‹¬å äº‹ä»¶
- å…¶ä»–æ‰€æœ‰äº‹ä»¶éƒ½ä¼šè¢«å±è”½
- é€‚ç”¨äºè¡¨ç°ç‰¹æ®Šçš„è´Ÿé¢çŠ¶æ€ï¼ˆå¦‚è¯…å’’ä¹‹å­ã€ç»ç—‡ã€é€šç¼‰çŠ¯ã€æ¶é­”å¥‘çº¦ç­‰ï¼‰

```javascript
["è¯…å’’ä¹‹å­", {
    description: "è¢«ç¥ç§˜åŠ›é‡è¯…å’’",
    is_red: true,
    exclusive_events: ["curse_event"],
    priority_events: []
}]
```

### 2.3 åŠ¨æ€æ ‡ç­¾ç³»ç»Ÿ

åŠ¨æ€æ ‡ç­¾æ˜¯å¸¦æœ‰æ•°å€¼çš„ç‰¹æ®Šæ ‡ç­¾ï¼ˆå¦‚"å­¦ä¹ æˆç»©:5"ã€"éŸ³ä¹å¤©èµ‹:3"ç­‰ï¼‰ï¼š

```javascript
["å­¦ä¹ æˆç»©", {
    description: "å­¦ä¹ æˆç»©æ°´å¹³",
    is_dynamic: true,
    prefix: "å­¦ä¹ æˆç»©:",
    exclusive_events: [],
    priority_events: ["academic_competition", "scholarship_opportunity"]
}]
```

## ä¸‰ã€æ·»åŠ å„ç±»äº‹ä»¶çš„æ–¹æ³•

### 3.1 æ·»åŠ æ™®é€šå¼€å±€äº‹ä»¶

```javascript
// åœ¨ STARTING_EVENTS ä¸­æ·»åŠ 
"normal_birth_artist": {
    title: "è‰ºæœ¯ä¸–å®¶",
    description: "{user}å‡ºç”Ÿåœ¨ä¸€ä¸ªå……æ»¡è‰ºæœ¯æ°”æ¯çš„å®¶åº­ã€‚",
    weight: 12,  // æƒé‡ï¼Œå½±å“è¢«é€‰ä¸­çš„æ¦‚ç‡
    trigger_conditions: {},  // å¼€å±€äº‹ä»¶é€šå¸¸æ²¡æœ‰è§¦å‘æ¡ä»¶
    options: [
        {
            text: "ç»§æ‰¿è‰ºæœ¯å¤©èµ‹",
            result: "{user}ä»å°å°±è¢«è‰ºæœ¯ç†é™¶ã€‚",
            effects: { 
                money: 60, 
                health: 75, 
                intelligence: 85, 
                social: 80, 
                luck: 70 
            },
            add_tags: ["è‰ºæœ¯å®¶åº­", "è‰ºæœ¯å¤©åˆ†"]
        }
    ]
}
```

### 3.2 æ·»åŠ ç‰¹æ®Šè¿ç»­å¼€å±€

ç‰¹æ®Šå¼€å±€é€šå¸¸åŒ…å«å¤šä¸ªè¿ç»­äº‹ä»¶ï¼š

```javascript
// æ­¥éª¤1ï¼šåœ¨ STARTING_EVENTS ä¸­æ·»åŠ ç‰¹æ®Šå¼€å±€
"special_alien_birth": {
    title: "å¤–æ˜Ÿæ¥å®¢",
    description: "ä¸€ä¸ªç¥ç§˜çš„é£èˆ¹é™è½åœ¨åœ°çƒï¼Œ{user}ä»ä¸­èµ°å‡º...",
    weight: 1,  // å¾ˆä½çš„æƒé‡ï¼Œå› ä¸ºæ˜¯ç‰¹æ®Šäº‹ä»¶
    trigger_conditions: {},
    options: [],  // æ— é€‰é¡¹ï¼Œç›´æ¥è¿›å…¥åç»­äº‹ä»¶
    continue_event: "alien_identity_choice",  // æŒ‡å®šåç»­äº‹ä»¶
    effects: { 
        money: 50, 
        health: 100, 
        intelligence: 90, 
        social: 40, 
        luck: 80 
    },
    add_tags: ["å¤–æ˜Ÿè¡€ç»Ÿ", "ç¥ç§˜èº«ä¸–"]
}

// æ­¥éª¤2ï¼šåœ¨ STARTING_TAG_EVENTS ä¸­æ·»åŠ åç»­äº‹ä»¶
"alien_identity_choice": {
    title: "èº«ä»½é€‰æ‹©",
    description: "ä½œä¸ºå¤–æ˜Ÿæ¥å®¢ï¼Œ{user}éœ€è¦é€‰æ‹©å¦‚ä½•èå…¥åœ°çƒ...",
    trigger_conditions: {
        required_tags: ["å¤–æ˜Ÿè¡€ç»Ÿ"],
        age_range: [0, 0]
    },
    options: [
        {
            text: "éšè—èº«ä»½",
            result: "{user}å†³å®šåƒæ™®é€šåœ°çƒäººä¸€æ ·ç”Ÿæ´»ã€‚",
            effects: { social: 10 },
            add_tags: ["éšè—èº«ä»½"],
            continue_event: "alien_power_awakening"
        },
        {
            text: "å…¬å¼€èº«ä»½",
            result: "{user}å‘ä¸–ç•Œå…¬å¼€äº†è‡ªå·±çš„å¤–æ˜Ÿèº«ä»½ï¼",
            effects: { social: -20, intelligence: 10 },
            add_tags: ["å…¬å¼€çš„å¤–æ˜Ÿäºº"]
        }
    ]
}
```

### 3.3 æ·»åŠ æ¡ä»¶ç»“æœäº‹ä»¶

ä½¿ç”¨ `conditional_results` å®ç°æ›´å¤æ‚çš„åˆ†æ”¯é€»è¾‘ï¼š

```javascript
"complex_choice_event": {
    title: "é‡å¤§æŠ‰æ‹©",
    description: "é¢ä¸´ä¸€ä¸ªé‡è¦çš„äººç”Ÿé€‰æ‹©...",
    trigger_conditions: { age_range: [25, 35] },
    options: [
        {
            text: "å†’é™©ä¸€æ",
            conditional_results: [
                {
                    // å¤šä¸ªæ¡ä»¶çš„ç»„åˆ
                    conditions: {
                        tags: ["ä¼ä¸šå®¶", "æŠ•èµ„é«˜æ‰‹"],
                        attributes: { intelligence: 85, luck: 70 },
                        all_required: true  // æ‰€æœ‰æ¡ä»¶éƒ½å¿…é¡»æ»¡è¶³
                    },
                    result: "å‡­å€Ÿç»éªŒå’Œè¿æ°”ï¼Œ{user}å¤§è·æˆåŠŸï¼",
                    effects: { money: 100, social: 30 },
                    add_tags: ["å•†ä¸šä¼ å¥‡"]
                },
                {
                    // æˆ–æ¡ä»¶
                    conditions: {
                        any_of: [
                            { tags: ["å¹¸è¿æ˜Ÿ"] },
                            { attributes: { luck: 90 } }
                        ]
                    },
                    result: "è¿æ°”ä½¿ç„¶ï¼Œ{user}è·å¾—äº†ä¸é”™çš„å›æŠ¥ã€‚",
                    effects: { money: 50 }
                },
                {
                    // æ’é™¤æ¡ä»¶
                    conditions: {
                        not: { tags: ["å€’éœ‰è›‹", "æŠ•èµ„å¤±è´¥"] }
                    },
                    result: "{user}çš„é€‰æ‹©å¸¦æ¥äº†ä¸€äº›æ”¶ç›Šã€‚",
                    effects: { money: 20 }
                },
                {
                    // é»˜è®¤ç»“æœ
                    conditions: { default: true },
                    result: "äº‹æƒ…æ²¡æœ‰æŒ‰è®¡åˆ’è¿›è¡Œ...",
                    effects: { money: -30 }
                }
            ]
        }
    ]
}
```

### 3.4 æ·»åŠ åŠ¨æ€ç»“æœäº‹ä»¶

ä½¿ç”¨ `dynamic_result` å‡½æ•°åŠ¨æ€ç”Ÿæˆç»“æœï¼š

```javascript
"dynamic_event": {
    title: "è€ƒè¯•æˆç»©",
    description: "æœŸæœ«è€ƒè¯•æˆç»©å‡ºæ¥äº†...",
    trigger_conditions: { 
        age_range: [7, 18],
        required_tags: ["å°å­¦ç”Ÿ"]
    },
    options: [
        {
            text: "æŸ¥çœ‹æˆç»©",
            result: "é»˜è®¤ç»“æœ",  // ä¼šè¢«dynamic_resultè¦†ç›–
            dynamic_result: function(player) {
                // æ ¹æ®å­¦ä¹ æˆç»©æ ‡ç­¾åŠ¨æ€ç”Ÿæˆç»“æœ
                const scoreTag = player.tags.find(tag => tag.startsWith("å­¦ä¹ æˆç»©:"));
                if (!scoreTag) return null;
                
                const score = parseInt(scoreTag.split(":")[1]);
                
                if (score >= 5) {
                    return {
                        result: "{user}è€ƒäº†å…¨ç­ç¬¬ä¸€ï¼",
                        effects: { intelligence: 10, social: 15 },
                        add_tags: ["å­¦éœ¸", "ä¼˜ç­‰ç”Ÿ"]
                    };
                } else if (score >= 0) {
                    return {
                        result: "{user}æˆç»©ä¸­ç­‰ï¼Œè¿˜éœ€åŠªåŠ›ã€‚",
                        effects: { intelligence: 5 }
                    };
                } else {
                    return {
                        result: "{user}æˆç»©ä¸ç†æƒ³ï¼Œéœ€è¦åŠ æ²¹äº†ã€‚",
                        effects: { social: -5 },
                        add_tags: ["å­¦æ¸£"]
                    };
                }
            }
        }
    ]
}
```

### 3.5 æ·»åŠ å¹´é¾„æ®µäº‹ä»¶

åœ¨ç›¸åº”çš„å¹´é¾„æ®µå¯¹è±¡ä¸­æ·»åŠ äº‹ä»¶ï¼š

```javascript
// å¹¼å„¿æœŸäº‹ä»¶ (1-5å²)
toddler: {
    "first_day_kindergarten": {
        title: "ç¬¬ä¸€å¤©ä¸Šå¹¼å„¿å›­",
        description: "{user}ç¬¬ä¸€æ¬¡ç¦»å¼€çˆ¶æ¯å»å¹¼å„¿å›­...",
        trigger_conditions: { age_range: [3, 4] },
        options: [
            {
                text: "å‹‡æ•¢é¢å¯¹",
                result: "{user}å¾ˆå¿«é€‚åº”äº†å¹¼å„¿å›­ç”Ÿæ´»ã€‚",
                effects: { social: 10, intelligence: 5 },
                add_tags: ["ç‹¬ç«‹"]
            },
            {
                text: "å“­é—¹ä¸æ­¢",
                result: "{user}å“­äº†ä¸€æ•´å¤©ï¼Œä½†æœ€ç»ˆè¿˜æ˜¯é€‚åº”äº†ã€‚",
                effects: { health: -5, social: 5 }
            }
        ]
    }
}

// é’å°‘å¹´äº‹ä»¶ (13-18å²)
teenager: {
    "career_guidance": {
        title: "èŒä¸šè§„åˆ’",
        description: "å­¦æ ¡ç»„ç»‡èŒä¸šè§„åˆ’è¯¾ç¨‹...",
        trigger_conditions: { age_range: [16, 18] },
        options: [
            {
                text: "ç«‹å¿—ä»åŒ»",
                result: "{user}å†³å®šå°†æ¥æˆä¸ºåŒ»ç”Ÿã€‚",
                effects: { intelligence: 10 },
                add_tags: ["åŒ»å­¦å¿—å‘"]
            },
            {
                text: "åˆ›ä¸šæ¢¦æƒ³",
                result: "{user}æ¢¦æƒ³åˆ›åŠè‡ªå·±çš„å…¬å¸ã€‚",
                effects: { social: 10 },
                add_tags: ["åˆ›ä¸šæ¢¦æƒ³"]
            }
        ]
    }
}
```

### 3.6 æ·»åŠ å¿…å®šè§¦å‘çš„æ ‡ç­¾äº‹ä»¶

é€šè¿‡ `exclusive_events` ç¡®ä¿äº‹ä»¶å¿…å®šè§¦å‘ï¼š

```javascript
// æ­¥éª¤1ï¼šåœ¨æ ‡ç­¾å®šä¹‰ä¸­è®¾ç½®ç‹¬å äº‹ä»¶
TAG_DEFINITIONS: new Map([
    ["å‘½è¿ä¹‹å­", {
        description: "èº«è´Ÿç‰¹æ®Šä½¿å‘½",
        exclusive_events: ["destiny_calling"],  // è¿™ä¸ªäº‹ä»¶ä¼šä¼˜å…ˆè§¦å‘
        priority_events: []
    }]
])

// æ­¥éª¤2ï¼šåˆ›å»ºå¯¹åº”çš„ç‹¬å äº‹ä»¶
TAG_EVENTS: {
    "destiny_calling": {
        title: "å‘½è¿çš„å¬å”¤",
        description: "é¢„è¨€ä¸­çš„æ—¶åˆ»åˆ°äº†...",
        trigger_conditions: {
            required_tags: ["å‘½è¿ä¹‹å­"],
            age_range: [18, 18]  // ç²¾ç¡®åœ¨18å²è§¦å‘
        },
        options: [
            {
                text: "æ¥å—å‘½è¿",
                result: "{user}è¸ä¸Šäº†å‘½ä¸­æ³¨å®šçš„é“è·¯ã€‚",
                effects: { health: 20, intelligence: 20, social: 20, luck: 20 },
                add_tags: ["è§‰é†’è€…"]
            }
        ]
    }
}
```
### 3.6 æ·»åŠ åŠ¨æ€æ ‡ç­¾çš„é€‰é¡¹

```javascript
options: [
    {
        text: "é€‰é¡¹æ–‡æœ¬",
        result: "é»˜è®¤ç»“æœ",
        dynamic_result: function(player) {
            return eventManager.updateDynamicTag(
                player,
                "å­¦ä¹ æˆç»©:",  // æ ‡ç­¾å‰ç¼€
                2,             // å˜åŒ–å€¼ï¼ˆæ­£æ•°å¢åŠ ï¼Œè´Ÿæ•°å‡å°‘ï¼‰
                "{user}çš„å­¦ä¹ æˆç»©æå‡äº†ã€‚"  // ç»“æœæ–‡æœ¬
            );
        }
    }
]

## å››ã€äº‹ä»¶è§¦å‘ä¼˜å…ˆçº§

1. **çº¢è‰²æ ‡ç­¾ç‹¬å äº‹ä»¶**ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
   - æ‹¥æœ‰çº¢è‰²æ ‡ç­¾æ—¶ï¼Œåªè§¦å‘å…¶ç‹¬å äº‹ä»¶
   
2. **æ™®é€šæ ‡ç­¾ç‹¬å äº‹ä»¶**ï¼ˆæ¬¡é«˜ä¼˜å…ˆçº§ï¼‰
   - æ ‡ç­¾å®šä¹‰ä¸­çš„ `exclusive_events`
   
3. **æ ‡ç­¾ä¼˜å…ˆäº‹ä»¶**ï¼ˆè¾ƒé«˜ä¼˜å…ˆçº§ï¼‰
   - æ ‡ç­¾å®šä¹‰ä¸­çš„ `priority_events`
   - æœ‰3å€çš„æƒé‡è¢«é€‰ä¸­
   
4. **æ™®é€šäº‹ä»¶**ï¼ˆæ­£å¸¸ä¼˜å…ˆçº§ï¼‰
   - æ»¡è¶³æ¡ä»¶çš„æ‰€æœ‰å…¶ä»–äº‹ä»¶

## äº”ã€ç‰¹æ®Šæœºåˆ¶è¯´æ˜

### 5.1 é£é™©æœºåˆ¶

```javascript
options: [
    {
        text: "å±é™©é€‰æ‹©",
        result: "è¿™æ˜¯ä¸€ä¸ªæœ‰é£é™©çš„é€‰æ‹©...",
        effects: { health: -20 },
        risk: 0.3  // 30%æ¦‚ç‡ç›´æ¥æ­»äº¡
    }
]
```

### 5.2 å±æ€§é™åˆ¶

- å¥åº·ã€æ™ºåŠ›ã€ç¤¾äº¤ã€è¿æ°”ï¼š0-100
- é‡‘é’±ï¼š0-9999
- å¹´é¾„ï¼šè‡ªç„¶å¢é•¿

### 5.3 äº‹ä»¶é“¾è®¾è®¡å»ºè®®

1. å¼€å±€äº‹ä»¶é“¾ï¼šå¼€å±€ â†’ å¼€å±€æ ‡ç­¾äº‹ä»¶ â†’ æ ‡ç­¾äº‹ä»¶
2. å‰§æƒ…äº‹ä»¶é“¾ï¼šé€šè¿‡ `continue_event` è¿æ¥å¤šä¸ªäº‹ä»¶
3. æˆé•¿äº‹ä»¶é“¾ï¼šé€šè¿‡å¹´é¾„æ®µå’Œæ ‡ç­¾ç»„åˆè§¦å‘

### 5.4 æˆå°±ç³»ç»Ÿé›†æˆ

æ¸¸æˆåŒ…å«æˆå°±ç³»ç»Ÿï¼ŒæŸäº›æ ‡ç­¾å¯ä»¥è§£é”æˆå°±ï¼š

```javascript
// æˆå°±å®šä¹‰
achievements: [
    {
        id: 'bird_person',
        name: 'é¸Ÿäºº',
        description: 'æ•‘åŠ©è¿‡å°é¸Ÿ',
        icon: 'ğŸ¦',
        stars: 1,
        tag: 'é¸Ÿäºº',  // è·å¾—æ­¤æ ‡ç­¾æ—¶è‡ªåŠ¨è§£é”æˆå°±
        unlocked: false
    }
]
```

é‡‘è‰²æˆå°±æ ‡ç­¾åœ¨UIä¸­ä¼šæœ‰ç‰¹æ®Šæ•ˆæœï¼š
- å¸¦æœ‰é‡‘è‰²æ¸å˜èƒŒæ™¯
- é—ªçƒåŠ¨ç”»æ•ˆæœ
- è·å¾—æ—¶æœ‰ç‰¹æ®Šæç¤º

## å…­ã€è°ƒè¯•æŠ€å·§

1. ä½¿ç”¨ `console.log` åœ¨äº‹ä»¶ä¸­è¾“å‡ºè°ƒè¯•ä¿¡æ¯
2. æ£€æŸ¥ `eventManager.getAvailableEvents()` æŸ¥çœ‹å½“å‰å¯ç”¨äº‹ä»¶
3. ç¡®ä¿æ‰€æœ‰ `continue_event` å¼•ç”¨çš„äº‹ä»¶IDå­˜åœ¨
4. æµ‹è¯•æ¡ä»¶åˆ¤æ–­é€»è¾‘æ˜¯å¦æ­£ç¡®
5. ä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·æŸ¥çœ‹æ ‡ç­¾çŠ¶æ€

## ä¸ƒã€æœ€ä½³å®è·µ

1. **å¹³è¡¡æ€§**ï¼šæ³¨æ„å±æ€§æ•ˆæœçš„å¹³è¡¡ï¼Œé¿å…è¿‡å¼ºæˆ–è¿‡å¼±
2. **è¿è´¯æ€§**ï¼šäº‹ä»¶é“¾è¦æœ‰é€»è¾‘è¿è´¯æ€§
3. **å¤šæ ·æ€§**ï¼šä¸ºåŒä¸€æƒ…å†µæä¾›å¤šç§é€‰æ‹©
4. **è¶£å‘³æ€§**ï¼šåŠ å…¥å¹½é»˜å…ƒç´ å’Œæ„å¤–è½¬æŠ˜
5. **çœŸå®æ€§**ï¼šäº‹ä»¶è¦ç¬¦åˆå¹´é¾„ç‰¹å¾å’Œç”Ÿæ´»é€»è¾‘
6. **æ ‡ç­¾ç®¡ç†**ï¼šåˆç†ä½¿ç”¨ `add_tags` å’Œ `remove_tags`
7. **åŠ¨æ€å†…å®¹**ï¼šå–„ç”¨ `dynamic_result` åˆ›å»ºä¸ªæ€§åŒ–ä½“éªŒ

## å…«ã€æ–‡ä»¶ç»“æ„

- `startEvents.js` - å¼€å±€äº‹ä»¶å’Œå¼€å±€æ ‡ç­¾äº‹ä»¶
- `ageEvents.js` - å¹´é¾„æ®µäº‹ä»¶ï¼ˆå¹¼å„¿ã€ç«¥å¹´ã€é’å°‘å¹´ã€æˆå¹´ã€ä¸­å¹´ã€è€å¹´ï¼‰
- `tagEvents.js` - æ ‡ç­¾è§¦å‘äº‹ä»¶
- `tags.js` - æ ‡ç­¾å®šä¹‰
- `eventManager.js` - äº‹ä»¶ç®¡ç†ç³»ç»Ÿ
- `achievements.js` - æˆå°±ç³»ç»Ÿ

é€šè¿‡ä»¥ä¸Šæ–¹æ³•ï¼Œä½ å¯ä»¥åˆ›å»ºä¸°å¯Œå¤šæ ·çš„æ¸¸æˆå†…å®¹ï¼Œè®©æ¯æ¬¡æ¸¸æˆä½“éªŒéƒ½ç‹¬ä¸€æ— äºŒï¼